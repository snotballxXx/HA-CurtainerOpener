<!DOCTYPE html>
<html>
  <!--
Build LittleFs with:
pio run --target buildfs

Ctrl + Shift + P and select PlatformIO: New Terminal
  -->
  <head>
    <title>Curtain - {ENTITY_ID}</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M23 3H1V1H23V3M2 22H6C6 19 4 17 4 17C10 13 11 4 11 4H2V22M22 4H13C13 4 14 13 20 17C20 17 18 19 18 22H22V4Z' fill='%23007BFF'/%3E%3C/svg%3E"
    />

    <style>
      body {
        font-family: sans-serif;
        padding: 40px;
        background-color: #ffffff;
      }

      button {
        background-color: #333;
        color: white;
        border: none;
        padding: 8px 16px;
        margin-right: 10px;
        cursor: pointer;
        font-size: 14px;
      }
      button:disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      /* Header styling */
      .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 10px;
        background-color: #3ba0e3;
        text-align: left;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        color: #ffffff;
      }

      .center-title {
        text-align: center;
        font-size: 60px;
        font-weight: bold;
      }

      /* Footer styling */
      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%; /* Optional: Adjust width if needed */
        padding: 10px;
        background-color: #3ba0e3;
        text-align: left;
        box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.1);
        color: #ffffff;
      }

      #messageBox {
        width: 100%;
        height: 350px;
        background-color: #1e1e1e;
        border: 1px solid #333;
        color: white;
        padding: 10px;
        overflow-y: auto;
        white-space: pre-wrap;
      }

      #resetBtn {
        background-color: #333;
        color: white;
        border: none;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        margin: 20px;
      }
      #resetBtn:hover {
        background-color: #555;
      }
      /* Flexbox container for the two columns */
      .container {
        display: flex;
        margin-top: 50px;
      }
      /* First column for local elements */
      .local-elements {
        flex: 1;
        padding: 10px;
        margin-left: 50px;
        margin-top: 50px;
      }
      #statusIndicator {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: bold;
        margin-left: 10px;
      }
      .status-connected {
        background-color: #2ecc71;
        color: #000;
      }
      .status-disconnected {
        background-color: #e74c3c;
        color: #fff;
      }

      #sliderContainer {
        margin-top: 20px;
      }
      input[type="range"] {
        width: 100%;
      }
      #sliderValue {
        font-weight: bold;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="header center-title">Curtain Control - ({ENTITY_ID})</div>
    <div class="container">
      <!-- First column for local elements -->
      <div class="local-elements">
        <a href="/">Home</a>
        <h1>
          Logs
          <span id="statusIndicator" class="status-disconnected"
            >Disconnected</span
          >
        </h1>

        <div id="messageBox"></div>
        <button id="connectBtn">Connect</button>
        <button id="disconnectBtn" disabled>Disconnect</button>

        <button id="resetBtn">Reset</button>
        <div id="sliderContainer">
          <input type="range" id="slider" min="1" max="25" value="1" />
          <div id="sliderValue">Value: 1</div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <h4>{VERSION}</h4>
    </footer>

    <script>
      const messageBox = document.getElementById("messageBox");
      const resetBtn = document.getElementById("resetBtn");
      const connectBtn = document.getElementById("connectBtn");
      const disconnectBtn = document.getElementById("disconnectBtn");
      const statusIndicator = document.getElementById("statusIndicator");
      const slider = document.getElementById("slider");
      const sliderValue = document.getElementById("sliderValue");

      let ws = null;

      function logMessage(text) {
        const msg = document.createElement("div");
        msg.className = "message";
        msg.textContent = text;
        messageBox.appendChild(msg);
        messageBox.scrollTop = messageBox.scrollHeight;
      }
      function updateStatus(connected) {
        if (connected) {
          statusIndicator.textContent = "Connected";
          statusIndicator.className = "status-connected";
        } else {
          statusIndicator.textContent = "Disconnected";
          statusIndicator.className = "status-disconnected";
        }
      }

      connectBtn.onclick = () => {
        ws = new WebSocket(`ws://${location.hostname}:81`);

        ws.onopen = () => {
          logMessage("Connected to WebSocket");
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          updateStatus(true);
        };

        ws.onmessage = (event) => {
          logMessage(`${event.data}`);
        };

        ws.onerror = () => {
          logMessage("WebSocket error");
        };

        ws.onclose = () => {
          logMessage("WebSocket disconnected");
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
          updateStatus(false);
        };
      };

      disconnectBtn.onclick = () => {
        if (ws) {
          ws.close();
          ws = null;
        }
      };

      resetBtn.onclick = () => {
        messageBox.innerHTML = "";
      };

      updateStatus(false);

      slider.addEventListener("input", () => {
        const value = slider.value;
        sliderValue.textContent = `Value: ${value}`;
        if (ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({ slider: value }));
        }
      });

      connectBtn.click();
    </script>
  </body>
</html>
